<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoiPod ë¸Œë ˆì´ë‹ˆë©€ ë¦¬í¬íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        :root {
            --pdf-scale: 1;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f2f5;
            transition: none !important;
        }
        body.pdf-mode {
            --pdf-scale: 0.92;
            background-color: #ffffff !important;
        }
        .gradient-text {
            background: linear-gradient(to right, #4f46e5, #0ea5e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .report-card {
            background-color: white;
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        body.pdf-mode .report-card {
            padding: 1.75rem;
            box-shadow: none;
            border-radius: 1rem;
        }
        .section-title {
            font-size: 1.875rem;
            font-weight: 800;
            color: #111827;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        body.pdf-mode .section-title {
            font-size: 1.55rem;
            margin-bottom: 1.25rem;
            padding-bottom: 0.6rem;
        }
        .brainimal-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            font-weight: 700;
            background: linear-gradient(to right, #ecfccb, #d9f99d);
            color: #4d7c0f;
            border: 1px solid #a3e635;
        }
        body.pdf-mode .brainimal-badge {
            padding: 0.4rem 1rem;
            font-size: 0.9rem;
        }
        .highlight-box {
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
        }
        body.pdf-mode .highlight-box {
            padding: 1.1rem;
            border-radius: 0.85rem;
        }
        .optional-tag {
            background-color: #e0e7ff;
            color: #4338ca;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            margin-left: 0.5rem;
        }
        body.pdf-mode .optional-tag {
            font-size: 0.65rem;
        }
        .modal { transition: opacity 0.3s ease; }
        .animate-scale-in { animation: scaleIn 0.3s cubic-bezier(0.165, 0.840, 0.440, 1.000) forwards; }
        @keyframes scaleIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .swipe-container { overflow: hidden; position: relative; }
        .swipe-track { display: flex; transition: transform 0.3s ease-out; }
        .swipe-slide { flex-shrink: 0; width: 100%; }
        .swipe-dots { text-align: center; margin-top: 1rem; }
        .swipe-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background-color: #cbd5e1; margin: 0 4px; cursor: pointer; transition: background-color 0.3s; }
        .swipe-dot.active { background-color: #4f46e5; }
        
        @media (min-width: 1024px) {
            .lg-grid-revert .swipe-track { display: grid; transform: none !important; }
            .lg-grid-revert .swipe-slide { width: auto; }
            .lg-stack-revert .swipe-track { display: block; transform: none !important; }
            .lg-stack-revert .swipe-track > .swipe-slide:not(:last-child) { margin-bottom: 2rem; }
            .lg-stack-revert .swipe-slide { width: auto; padding: 0 !important; }
            .lg-stack-revert .swipe-dots { display: none; }
        }

        body.pdf-mode .swipe-container .swipe-track {
            display: grid !important;
            gap: 1rem;
            transform: none !important;
        }
        body.pdf-mode .swipe-container .swipe-slide {
            width: auto !important;
            padding: 0 !important;
        }
        body.pdf-mode .swipe-dots {
            display: none !important;
        }

        .premium-lock { position: relative; overflow: hidden; flex-grow: 1; display: flex; flex-direction: column; }
        .premium-overlay { position: absolute; inset: 0; background-color: rgba(226, 232, 240, 0.7); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); display: flex; justify-content: center; align-items: center; flex-direction: column; gap: 0.75rem; color: #475569; font-weight: 700; cursor: pointer; z-index: 10; border-radius: 1rem; text-align: center; display: none; }
        .premium-overlay.active { display: flex; }
        .trend-btn { background-color: #f1f5f9; color: #475569; font-size: 0.875rem; font-weight: 600; padding: 0.25rem 0.75rem; border-radius: 9999px; margin-left: auto; display: inline-flex; align-items: center; gap: 0.25rem; }
        .trend-btn:hover { background-color: #e2e8f0; }
        .trend-container { border: 1px solid #e2e8f0; border-radius: 1rem; padding: 1.5rem; margin-top: 2rem; display: none; }
        .metric-toggle-group { display: flex; flex-wrap: wrap; gap: 0.75rem; }
        .metric-toggle { padding: 0.5rem 1rem; border-radius: 9999px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; display: flex; align-items: center; gap: 0.5rem; }
        .metric-toggle.inactive { background-color: #f1f5f9; color: #64748b; }
        .metric-toggle.inactive:hover { background-color: #e2e8f0; }
        .fallback-text-container { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; min-height: 40px; background-color: #f8fafc; border-radius: 0.5rem; color: #94a3b8; font-weight: 500; }
    
        #pdfLoader {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }
        #pdfLoader div {
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
        }
        #pdfLoader svg {
            width: 50px;
            height: 50px;
            margin: 0 auto 1rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .page-break-pdf {
            display: none;
            page-break-after: always;
            height: 1px;
            visibility: hidden;
        }
        body.pdf-mode .page-break-pdf {
            display: block;
        }
        body.pdf-mode p,
        body.pdf-mode li,
        body.pdf-mode span,
        body.pdf-mode button,
        body.pdf-mode .text-slate-600,
        body.pdf-mode .text-slate-500 {
            font-size: calc(0.97rem * var(--pdf-scale));
        }
        body.pdf-mode h2 { font-size: 2.1rem; }
        body.pdf-mode h3 { font-size: 1.55rem; }
        body.pdf-mode h4 { font-size: 1.2rem; }
        body.pdf-mode h5 { font-size: 1rem; }
        body.pdf-mode h6 { font-size: 0.95rem; }
        body.pdf-mode footer { font-size: 0.7rem; }
        body.pdf-mode footer p { font-size: 0.7rem; }
        body.pdf-mode .trend-container {
            padding: 1.1rem;
            margin-top: 1.25rem;
        }
        body.pdf-mode .metric-toggle {
            padding: 0.35rem 0.75rem;
            font-size: 0.8rem;
        }
        body.pdf-mode .premium-overlay { display: none !important; }
        body.pdf-mode #reportContent {
            max-width: 794px;
            margin: 0 auto;
        }
        body.pdf-mode .profile-photo {
            width: 120px !important;
            height: 120px !important;
        }
        body.pdf-mode .report-header-info {
            gap: 1rem !important;
        }
        body.pdf-mode .badge-row {
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        body.pdf-mode .age-info {
            gap: 0.75rem;
        }
        body.pdf-mode canvas {
            max-height: 220px;
        }
        @media print {
            body { background-color: #ffffff !important; }
            #reportContent { max-width: 794px; margin: 0 auto; }
            .report-card { box-shadow: none; }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-10">
    <div class="max-w-4xl mx-auto">
        <div class="report-card" id="reportContent"> 
            <section class="mb-12">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8 items-center">
                    <div class="md:col-span-3 flex flex-col sm:flex-row items-start sm:items-center space-y-6 sm:space-y-0 sm:space-x-8 report-header-info">
                        <div class="profile-photo w-32 h-32 sm:w-40 sm:h-40 rounded-full overflow-hidden shadow-lg border-4 border-white flex-shrink-0">
                            <img src="https://placehold.co/200x200/E2E8F0/475569?text=..." alt="ì‚¬ìš©ì í”„ë¡œí•„ ì‚¬ì§„" class="w-full h-full object-cover" id="profileImage">
                        </div>
                        <div>
                            <p class="text-slate-500 text-lg" id="reportInfo"></p>
                            <h2 class="text-4xl font-extrabold text-slate-800 mt-1"><span id="userName"></span> <span class="text-2xl font-medium">ë‹˜</span></h2>
                            <div class="mt-4 flex flex-wrap gap-x-6 gap-y-2 text-slate-600 age-info" id="ageInfoContainer"></div>
                            <div class="mt-6 flex items-center gap-4 badge-row">
                                <div class="brainimal-badge"><span id="brainimalType"></span></div>
                                <button id="openModalBtn" class="text-sm text-indigo-600 font-semibold hover:underline flex items-center space-x-1"><i data-lucide="help-circle" class="w-4 h-4"></i><span>ëª¨ë“  íƒ€ì… ë³´ê¸°</span></button>
                            </div>
                        </div>
                    </div>
                    <div id="actionButtons" class="md:col-span-1 flex md:flex-col items-center justify-end md:justify-center gap-4">
                        <button id="shareBtn" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg flex items-center justify-center space-x-2 transition-colors"><i data-lucide="share-2" class="w-5 h-5"></i><span>ê³µìœ í•˜ê¸°</span></button>
                        <button id="saveBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center space-x-2 transition-colors"><i data-lucide="save" class="w-5 h-5"></i><span>ì €ì¥í•˜ê¸°</span></button>
                    </div>
                </div>
            </section>

            <section class="mb-12">
                <h3 class="section-title"><span class="mr-3">ğŸ§ </span>ë‘ë‡Œ ë‚˜ì´ ë¶„ì„</h3>
                <div id="brain-analysis-container" class="swipe-container lg-grid-revert">
                    <div class="swipe-track lg:grid lg:grid-cols-2 lg:gap-8">
                        <div class="swipe-slide p-1 lg:p-0"><div class="highlight-box h-full"><h4 class="text-xl font-bold text-slate-700 mb-4 flex items-center">í•µì‹¬ ë‘ë‡Œ ëŠ¥ë ¥<button id="toggleBrainTrendBtn" class="trend-btn premium-feature"><i data-lucide="line-chart" class="w-4 h-4"></i><span>ë³€í™” ì¶”ì´ í™•ì¸</span></button></h4><canvas id="brainChart"></canvas></div></div>
                        <div class="swipe-slide p-1 lg:p-0"><div class="highlight-box flex flex-col h-full"><h4 class="text-xl font-bold text-slate-700 mb-4 flex items-center">ë‡Œ í™œì„±ë„ ë§µ<span class="optional-tag">í”„ë¦¬ë¯¸ì—„</span></h4><div class="premium-lock"><div id="brain-map-container" class="space-y-2"></div><div class="mt-6 pt-4 border-t border-slate-200"><div class="flex justify-between items-center text-xs font-semibold text-slate-600 mb-1"><span>ë‚®ì€ í˜ˆë¥˜ëŸ‰</span><span>ë†’ì€ í˜ˆë¥˜ëŸ‰</span></div><div class="w-full h-4 rounded-full" style="background: linear-gradient(to right, #3b82f6, #a5b4fc, white, #fde047, #f87171);"></div><p class="text-center text-xs text-slate-500 mt-2 leading-relaxed">í˜ˆë¥˜ëŸ‰ì´ ë†’ì„ìˆ˜ë¡ í•´ë‹¹ ì „ì „ë‘ì—½ ì˜ì—­ì´ í™œì„±í™”ë¨ì„ ë‚˜íƒ€ë‚´ë©°, <br>ì•ˆì •ì‹œì—” ì ë‹¹íˆ ë‚®ì„ìˆ˜ë¡, ì§‘ì¤‘ì‹œì—” ì ë‹¹íˆ ë†’ì„ìˆ˜ë¡ ì¢‹ìŠµë‹ˆë‹¤.</p></div><div class="premium-overlay"><i data-lucide="lock" class="w-10 h-10"></i><span>í”„ë¦¬ë¯¸ì—„ ì „ìš© ì½˜í…ì¸ </span></div></div></div></div>
                    </div>
                    <div class="swipe-dots lg:hidden"></div>
                </div>
                <div id="brainTrendContainer" class="trend-container"><div class="flex justify-between items-center mb-4 flex-wrap gap-y-2"><div id="brainTrendToggles" class="metric-toggle-group"></div><p class="text-xs text-slate-500">âœ…: ëª©í‘œ ë‹¬ì„±! &nbsp; âš ï¸: ëª©í‘œ ê·¼ì ‘ &nbsp; ğŸ“‰: ë¶„ë°œ í•„ìš”</p></div><canvas id="brainTrendChart"></canvas></div>
            </section>
            
            <section class="mb-12">
                <h3 class="section-title"><span class="mr-3">ğŸƒâ€â™‚ï¸</span>ì‹ ì²´ ë‚˜ì´ ë¶„ì„</h3>
                <div id="physical-analysis-container" class="swipe-container lg-grid-revert">
                    <div class="swipe-track lg:grid lg:grid-cols-2 lg:gap-8">
                        <div class="swipe-slide p-1 lg:p-0"><div class="highlight-box h-full"><h4 class="text-xl font-bold text-slate-700 mb-4 flex items-center">í•µì‹¬ ì‹ ì²´ ëŠ¥ë ¥<button id="togglePhysicalTrendBtn" class="trend-btn premium-feature"><i data-lucide="line-chart" class="w-4 h-4"></i><span>ë³€í™” ì¶”ì´ í™•ì¸</span></button></h4><canvas id="physicalChart"></canvas></div></div>
                        <div class="swipe-slide p-1 lg:p-0"><div class="highlight-box flex flex-col h-full"><h4 class="text-xl font-bold text-slate-700 mb-4 flex items-center">í”¼ì§€ì»¬ ë””í…Œì¼<span class="optional-tag">í”„ë¦¬ë¯¸ì—„</span></h4><div class="premium-lock"><div class="grid grid-cols-2 gap-3 text-center my-auto" id="physicalDetailsContainer"></div><div class="premium-overlay"><i data-lucide="lock" class="w-10 h-10"></i><span>í”„ë¦¬ë¯¸ì—„ ì „ìš© ì½˜í…ì¸ </span></div></div></div></div>
                    </div>
                    <div class="swipe-dots lg:hidden"></div>
                </div>
                 <div id="physicalTrendContainer" class="trend-container"><div class="flex justify-between items-center mb-4 flex-wrap gap-y-2"><div id="physicalTrendToggles" class="metric-toggle-group"></div><p class="text-xs text-slate-500">âœ…: ëª©í‘œ ë‹¬ì„±! &nbsp; âš ï¸: ëª©í‘œ ê·¼ì ‘ &nbsp; ğŸ“‰: ë¶„ë°œ í•„ìš”</p></div><canvas id="physicalTrendChart"></canvas></div>
            </section>

            <div class="page-break-pdf"></div>

            <section class="mb-12">
                <h3 class="section-title"><span class="mr-3">ğŸ“Š</span>ë‡Œì§€ì»¬ ì¢…í•© í‰ê°€</h3>
                <div class="bg-gradient-to-br from-indigo-50 to-sky-50 p-4 lg:p-8 rounded-2xl swipe-container lg-stack-revert" id="summary-container">
                    <div class="swipe-track">
                        <div class="swipe-slide"><p class="text-xl font-bold leading-relaxed text-slate-800" id="brainimalSummary"></p></div>
                        <div class="swipe-slide"><div class="highlight-box bg-white/70 h-full"><h4 class="text-lg font-bold text-slate-700 mb-3 flex items-center"><span class="mr-2">ğŸ”</span>ìƒì„¸ ë¶„ì„</h4><p class="text-slate-600 mb-6" id="brainimalDescription"></p><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h5 class="font-bold text-green-700 mb-2">âœ… ì¥ì </h5><ul class="space-y-2 list-disc list-inside text-slate-600" id="advantagesList"></ul></div><div><h5 class="font-bold text-amber-700 mb-2">âš ï¸ ë‹¨ì </h5><ul class="space-y-2 list-disc list-inside text-slate-600" id="disadvantagesList"></ul></div></div></div></div>
                        <div class="swipe-slide"><div class="highlight-box bg-white/70 h-full flex flex-col"><h4 class="text-lg font-bold text-slate-700 mb-3 flex items-center"><span class="mr-2">âœ¨</span>ë°€ì°© í”¼ë“œë°±</h4><div class="premium-lock"><p class="text-slate-600 mb-6" id="feedbackIntro"></p><div class="space-y-6" id="feedbackContent"></div><div class="premium-overlay"><i data-lucide="lock" class="w-10 h-10"></i><span>í”„ë¦¬ë¯¸ì—„ ì „ìš© ì½˜í…ì¸ </span></div></div></div></div>
                    </div>
                    <div class="swipe-dots"></div>
                </div>
            </section>
            
            <section class="mb-12">
                <h3 class="section-title"><span class="mr-3">ğŸ‘‘</span>ì¶”ì²œ ë¡¤ëª¨ë¸</h3>
                <div class="swipe-container lg-grid-revert" id="rolemodel-container">
                    <div class="swipe-track lg:grid lg:grid-cols-5 lg:gap-8 lg:items-start">
                        <div class="swipe-slide p-1 lg:p-0 lg:col-span-3"><div class="highlight-box h-full bg-slate-50"><h4 class="text-xl font-bold text-slate-700 mb-4" id="roleModelName"></h4><p class="text-slate-600 leading-relaxed" id="roleModelDescription"></p></div></div>
                        <div class="swipe-slide p-1 lg:p-0 lg:col-span-2"><div class="highlight-box h-full"><h4 class="text-xl font-bold text-slate-700 mb-4">ì£¼ìš” ì—…ì  ë° ë°œìì·¨</h4><ul class="space-y-3" id="roleModelAchievements"></ul></div></div>
                    </div>
                    <div class="swipe-dots lg:hidden"></div>
                </div>
            </section>
        </div>

        <footer class="text-center mt-8 text-slate-500 text-xs">
            <p>ë³¸ ë¦¬í¬íŠ¸ëŠ” ì‚¬ìš©ìì˜ NoiPod í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ë¶„ì„ ìë£Œì´ë©°, ì˜ì‚¬ì˜ ì§„ë‹¨ê³¼ ê°™ì€ ì˜ë£Œì  ì†Œê²¬ì´ ì•„ë‹™ë‹ˆë‹¤.</p>
             <div class="mt-6 pt-6 border-t border-slate-200">
                 <div class="flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-8">
                      <div class="flex items-center"><img src="https://noilabofficial.github.io/noipod-report/Noi%20Lab%20%EB%A1%9C%EA%B3%A0(%EA%B0%80%EB%A1%9C).png" alt="Noi Lab Logo" class="h-6" onerror="this.alt='Noi Lab Logo'; this.onerror=null; this.src='https://placehold.co/100x24/ffffff/94a3b8?text=Noi+Lab';"></div>
                      <p class="text-slate-500 text-xs">ì„œìš¸íŠ¹ë³„ì‹œ ê´‘ì§„êµ¬ ëŠ¥ë™ë¡œ 81, ë”ë¼ì›€íœíŠ¸í•˜ìš°ìŠ¤ 3ì¸µ 7í˜¸</p>
                      <a href="#" class="flex items-center gap-1 text-slate-500 hover:text-indigo-600"><i data-lucide="instagram" class="w-4 h-4"></i><span class="text-xs">noi_lab.official</span></a>
                 </div>
             </div>
            <p class="mt-4">Â© 2025 NoiPod Inc. All Rights Reserved.</p>
        </footer>
    </div>
    
    <div id="pdfLoader">
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>
            PDF ìƒì„± ì¤‘...
        </div>
    </div>

    <div id="premiumModal" class="modal fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-8 relative animate-scale-in text-center">
             <button id="closePremiumModalBtn" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800"><i data-lucide="x" class="w-6 h-6"></i></button>
             <div class="w-16 h-16 rounded-full bg-indigo-100 flex items-center justify-center mx-auto mb-4">
                 <i data-lucide="gem" class="w-8 h-8 text-indigo-600"></i>
             </div>
             <h3 class="text-xl font-bold text-slate-800 mb-2">í”„ë¦¬ë¯¸ì—„ êµ¬ë… í›„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</h3>
             <p class="text-slate-500">êµ¬ë… í›„ ë” ë§ì€ í˜œíƒì„ ëˆ„ë ¤ë³´ì„¸ìš”!</p>
        </div>
    </div>
    <div id="brainimalModal" class="modal fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl p-8 relative animate-scale-in">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h3 class="text-2xl font-bold text-slate-800 mb-6">12ê°€ì§€ ë¸Œë ˆì´ë‹ˆë©€ íƒ€ì…</h3>
            <ul class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-5">
                 <li class="flex items-start"> <span class="text-xl mr-3">ğŸ¯</span><div><p class="font-bold">ì „ëµì ì¸ í˜¸ë‘ì´</p><p class="text-sm text-slate-500">ëª©í‘œë¥¼ í–¥í•´ ì „ëµì ìœ¼ë¡œ ì›€ì§ì´ëŠ” ë¦¬ë” íƒ€ì…</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ¦…</span><div><p class="font-bold">í†µì°°ë ¥ ìˆëŠ” ë…ìˆ˜ë¦¬</p><p class="text-sm text-slate-500">ë„“ì€ ì‹œì•¼ë¡œ ë¬¸ì œì˜ ë³¸ì§ˆì„ ê¿°ëš«ì–´ë´ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ¬</span><div><p class="font-bold">ëª…ì„í•œ ëŒê³ ë˜</p><p class="text-sm text-slate-500">ë†’ì€ ì§€ëŠ¥ê³¼ í•™ìŠµ ëŠ¥ë ¥ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì„±ì¥í•´ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ†</span><div><p class="font-bold">ë¹ ë¥¸ íŒë‹¨ì˜ ì¹˜íƒ€</p><p class="text-sm text-slate-500">ìˆœê°„ì ì¸ íŒë‹¨ë ¥ê³¼ ì‹¤í–‰ë ¥ì´ ë§¤ìš° ë›°ì–´ë‚˜ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ¦Š</span><div><p class="font-bold">ê· í˜• ì¡íŒ ì—¬ìš°</p><p class="text-sm text-slate-500">ìƒí™© íŒë‹¨ê³¼ ì ì‘ë ¥ì´ ë›°ì–´ë‚˜ê³  ë‹¤ì¬ë‹¤ëŠ¥í•´ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ»</span><div><p class="font-bold">ëˆê¸°ìˆëŠ” ê³°</p><p class="text-sm text-slate-500">í•œë²ˆ ì‹œì‘í•œ ì¼ì€ ëê¹Œì§€ í•´ë‚´ëŠ” ìš°ì§í•¨ì´ ìˆì–´ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸº</span><div><p class="font-bold">ì°½ì˜ì ì¸ ëŠ‘ëŒ€</p><p class="text-sm text-slate-500">ë…ì°½ì ì¸ ì•„ì´ë””ì–´ê°€ ë§ê³  ë¬¸ì œ í•´ê²° ë°©ì‹ì´ ìƒˆë¡œì›Œìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ¨</span><div><p class="font-bold">ì¹¨ì°©í•œ ì½”ì•Œë¼</p><p class="text-sm text-slate-500">ì–´ë–¤ ìƒí™©ì—ì„œë„ í‰ì •ì‹¬ì„ ìƒì§€ ì•Šì•„ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ¦</span><div><p class="font-bold">ëŒ€ë‹´í•œ ì‚¬ì</p><p class="text-sm text-slate-500">ê²°ë‹¨ë ¥ê³¼ ì¶”ì§„ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ ê·¸ë£¹ì„ ì´ëŒì–´ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ±</span><div><p class="font-bold">ì„¬ì„¸í•œ ê³ ì–‘ì´</p><p class="text-sm text-slate-500">ë””í…Œì¼ì„ ë†“ì¹˜ì§€ ì•ŠëŠ” ê¼¼ê¼¼í•¨ì„ ê°€ì¡Œì–´ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ¶</span><div><p class="font-bold">ì‚¬íšŒì„± ì¢‹ì€ ê°•ì•„ì§€</p><p class="text-sm text-slate-500">ì¹œí™”ë ¥ì´ ì¢‹ì•„ ì‚¬ëŒë“¤ê³¼ ì‰½ê²Œ ì–´ìš¸ë ¤ìš”</p></div></li><li class="flex items-start"> <span class="text-xl mr-3">ğŸ¦‰</span><div><p class="font-bold">ì§‘ì¤‘í•˜ëŠ” ë¶€ì—‰ì´</p><p class="text-sm text-slate-500">í•œ ë²ˆ ëª°ì…í•˜ë©´ ì—„ì²­ë‚œ ì§‘ì¤‘ë ¥ì„ ë°œíœ˜í•´ìš”</p></div></li>
            </ul>
        </div>
    </div>
    <div id="shareModal" class="modal fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-8 relative animate-scale-in"><button id="closeShareModalBtn" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800"><i data-lucide="x" class="w-6 h-6"></i></button><h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">ê³µìœ í•˜ê¸°</h3><div class="flex justify-around items-center"><button class="flex flex-col items-center space-y-2 text-slate-600 hover:text-indigo-600"><div class="bg-yellow-300 w-16 h-16 rounded-full flex items-center justify-center"><i data-lucide="message-circle" class="w-8 h-8 text-black"></i></div><span>ì¹´ì¹´ì˜¤í†¡</span></button><button class="flex flex-col items-center space-y-2 text-slate-600 hover:text-indigo-600"><div class="bg-slate-200 w-16 h-16 rounded-full flex items-center justify-center"><i data-lucide="smartphone" class="w-8 h-8 text-slate-800"></i></div><span>SMS</span></button><button class="flex flex-col items-center space-y-2 text-slate-600 hover:text-indigo-600"><div class="bg-slate-200 w-16 h-16 rounded-full flex items-center justify-center"><i data-lucide="link" class="w-8 h-8 text-slate-800"></i></div><span>URL ë³µì‚¬</span></button></div></div>
    </div>
    
    <script>
    const userData = {
      "userID": "user-a1b2c3d4e5", 
      "isPremium": true,
      "userName": "ê¹€ë…¸ì´",
      "reportCount": 10, "reportDate": "2025.10.20", "birth": "1996-05-20", "brainAge": 26, "physicalAge": 27, "brainimalType": "ğŸ¦Š ê· í˜• ì¡íŒ ì—¬ìš°",
      "brainScores": { "ê¸°ì–µë ¥": 85, "ì´í•´ë ¥": 80, "ì§‘ì¤‘ë ¥": 90, "íŒë‹¨ë ¥": 86 },
      "brainScoreHistory": [
          {"ê¸°ì–µë ¥": 35, "ì´í•´ë ¥": 70, "ì§‘ì¤‘ë ¥": 68, "íŒë‹¨ë ¥": 72}, {"ê¸°ì–µë ¥": 68, "ì´í•´ë ¥": 72, "ì§‘ì¤‘ë ¥": 70, "íŒë‹¨ë ¥": 75}, {"ê¸°ì–µë ¥": 70, "ì´í•´ë ¥": 71, "ì§‘ì¤‘ë ¥": 72, "íŒë‹¨ë ¥": 74}, {"ê¸°ì–µë ¥": 72, "ì´í•´ë ¥": 75, "ì§‘ì¤‘ë ¥": 75, "íŒë‹¨ë ¥": 78}, {"ê¸°ì–µë ¥": 75, "ì´í•´ë ¥": 74, "ì§‘ì¤‘ë ¥": 78, "íŒë‹¨ë ¥": 77}, {"ê¸°ì–µë ¥": 78, "ì´í•´ë ¥": 78, "ì§‘ì¤‘ë ¥": 80, "íŒë‹¨ë ¥": 82}, {"ê¸°ì–µë ¥": 80, "ì´í•´ë ¥": 76, "ì§‘ì¤‘ë ¥": 85, "íŒë‹¨ë ¥": 81}, {"ê¸°ì–µë ¥": 82, "ì´í•´ë ¥": 78, "ì§‘ì¤‘ë ¥": 88, "íŒë‹¨ë ¥": 79}, {"ê¸°ì–µë ¥": 85, "ì´í•´ë ¥": 80, "ì§‘ì¤‘ë ¥": 90, "íŒë‹¨ë ¥": 86}
      ],
      "brainScoreTarget": {"ê¸°ì–µë ¥": 90, "ì´í•´ë ¥": 80, "ì§‘ì¤‘ë ¥": 92, "íŒë‹¨ë ¥": 85},
      "brainMapImages": { "restingUrl": "https://noilabofficial.github.io/noipod-report/ê¹€ë…¸ì´10_R.png", "concentratingUrl": "https://noilabofficial.github.io/noipod-report/ê¹€ë…¸ì´10_C.png" },
      "physicalScores": { "ì§€êµ¬ë ¥": 80, "ìˆœë°œë ¥": 88, "ìœ ì—°ì„±": 72, "ë°¸ëŸ°ìŠ¤": 92 },
      "physicalScoreHistory": [
          {"ì§€êµ¬ë ¥": 68, "ìˆœë°œë ¥": 72, "ìœ ì—°ì„±": 65, "ë°¸ëŸ°ìŠ¤": 75}, {"ì§€êµ¬ë ¥": 70, "ìˆœë°œë ¥": 75, "ìœ ì—°ì„±": 68, "ë°¸ëŸ°ìŠ¤": 78}, {"ì§€êµ¬ë ¥": 72, "ìˆœë°œë ¥": 78, "ìœ ì—°ì„±": 67, "ë°¸ëŸ°ìŠ¤": 80}, {"ì§€êµ¬ë ¥": 75, "ìˆœë°œë ¥": 80, "ìœ ì—°ì„±": 70, "ë°¸ëŸ°ìŠ¤": 82}, {"ì§€êµ¬ë ¥": 74, "ìˆœë°œë ¥": 82, "ìœ ì—°ì„±": 71, "ë°¸ëŸ°ìŠ¤": 85}, {"ì§€êµ¬ë ¥": 78, "ìˆœë°œë ¥": 85, "ìœ ì—°ì„±": 70, "ë°¸ëŸ°ìŠ¤": 88}, {"ì§€êµ¬ë ¥": 77, "ìˆœë°œë ¥": 86, "ìœ ì—°ì„±": 72, "ë°¸ëŸ°ìŠ¤": 89}, {"ì§€êµ¬ë ¥": 79, "ìˆœë°œë ¥": 88, "ìœ ì—°ì„±": 71, "ë°¸ëŸ°ìŠ¤": 90}, {"ì§€êµ¬ë ¥": 80, "ìˆœë°œë ¥": 88, "ìœ ì—°ì„±": 72, "ë°¸ëŸ°ìŠ¤": 92}
      ],
      "physicalScoreTarget": {"ì§€êµ¬ë ¥": 85, "ìˆœë°œë ¥": 92, "ìœ ì—°ì„±": 75, "ë°¸ëŸ°ìŠ¤": 95},
      "physicalDetails": { "height": 178, "weight": 72, "bmi": 22.7, "avgHeartRate": null, "bmr": 1550, "bloodPressure": "115/75", "oxygenSaturation": null, "stressLevel": "ë‚®ìŒ"},
      "brainimalSummary": "ì™€, {userName}ë‹˜! ì¶•í•˜ë“œë ¤ìš”! ğŸ‰ <span class='gradient-text font-extrabold'>'{brainimalType}'</span> íƒ€ì…ì´ì‹œë„¤ìš”. ë‘ë‡Œì™€ ì‹ ì²´ ëŠ¥ë ¥ì´ ì¡°í™”ë¡­ê²Œ ë°œë‹¬í•´ì„œ, ì‹¤ì œ ë‚˜ì´ë³´ë‹¤ ë‘ë‡ŒëŠ” <span class='text-indigo-600 font-extrabold'>{brainAgeDiff}ì‚´</span>, ì‹ ì²´ëŠ” <span class='text-sky-600 font-extrabold'>{physicalAgeDiff}ì‚´</span>ì´ë‚˜ ì Šê²Œ ì¸¡ì •ë˜ì—ˆì–´ìš”!", "brainimalDescription": "'ê· í˜• ì¡íŒ ì—¬ìš°' íƒ€ì…ì€ ì–´ë–¤ ìƒí™©ì—ì„œë„ ë¹ ë¥´ê²Œ ì ì‘í•˜ê³  ìµœì ì˜ í•´ê²°ì±…ì„ ì°¾ì•„ë‚´ëŠ” ëŠ¥ë ¥ì´ íƒì›”í•´ìš”. ì•„ë§ˆ ì§ì¥ì´ë‚˜ ì¼ìƒìƒí™œì—ì„œ 'ì„¼ìŠ¤ìˆë‹¤', 'ì¼ ì˜í•œë‹¤'ëŠ” ì¹­ì°¬ì„ ìì£¼ ë“¤ìœ¼ì‹¤ ê±°ì˜ˆìš”. ë³µì¡í•œ ë¬¸ì œë¥¼ ë§Œë‚˜ë„ ì—¬ëŸ¬ ì •ë³´ë¥¼ ì¢…í•©í•´ í•µì‹¬ì„ ê¿°ëš«ì–´ ë³´ê³ , ì—¬ìš°ì²˜ëŸ¼ ë¯¼ì²©í•œ ì‹ ì²´ ëŠ¥ë ¥ìœ¼ë¡œ ì¬ë¹ ë¥´ê²Œ ëŒ€ì²˜í•˜ëŠ” ëª¨ìŠµì€ ì£¼ë³€ ì‚¬ëŒë“¤ì—ê²Œ ê¹Šì€ ì‹ ë¢°ê°ì„ ì¤€ë‹µë‹ˆë‹¤.", "advantages": [ "<strong>ë©€í‹°íƒœìŠ¤í‚¹:</strong> ì—¬ëŸ¬ ì¼ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ë©´ì„œë„ ì¤‘ìš”í•œ ë¶€ë¶„ì„ ë†“ì¹˜ì§€ ì•Šì•„ìš”.", "<strong>ìœ„ê¸°ê´€ë¦¬:</strong> ì˜ˆìƒì¹˜ ëª»í•œ ëŒë°œ ìƒí™©ì´ ìƒê²¨ë„ ë‹¹í™©í•˜ì§€ ì•Šê³  ì¹¨ì°©í•˜ê²Œ í•´ê²°í•´ìš”." ], "disadvantages": [ "<strong>ì—ë„ˆì§€ ì†Œëª¨:</strong> ë‹¤ì¬ë‹¤ëŠ¥í•œ ë§Œí¼, ì—¬ëŸ¬ ê³³ì— ì—ë„ˆì§€ë¥¼ ë¶„ì‚°ì‹œì¼œ ì‰½ê²Œ ì§€ì¹  ìˆ˜ ìˆì–´ìš”.", "<strong>ì„ íƒì˜ ì–´ë ¤ì›€:</strong> ì—¬ëŸ¬ ê°€ëŠ¥ì„±ì„ ë™ì‹œì— ê³ ë ¤í•˜ë‹¤ ë³´ë‹ˆ, ê°€ë” ì¤‘ìš”í•œ ê²°ì •ì„ ë‚´ë¦¬ëŠ” ë° ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”." ], "feedbackIntro": "ê¹€ë…¸ì´ë‹˜ì˜ ì¥ì ì„ ê·¹ëŒ€í™”í•˜ê³  ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•œ ìƒí™œ ìŠµê´€ê³¼ íŠ¸ë ˆì´ë‹ì„ ì¶”ì²œí•´ ë“œë¦´ê²Œìš”.",
      "feedbackContent": { "dailyEfforts": [ "<strong>'ì„ íƒê³¼ ì§‘ì¤‘' ì—°ìŠµí•˜ê¸°:</strong> í•˜ë£¨ ì‹œì‘ ì „, ê°€ì¥ ì¤‘ìš”í•œ ì¼ 3ê°€ì§€ë¥¼ ì •í•´ ìš°ì„  ì²˜ë¦¬í•˜ëŠ” ìŠµê´€ì€ ì—ë„ˆì§€ ì†Œëª¨ë¥¼ ì¤„ì´ê³  íŒë‹¨ë ¥ì„ ë” ë‚ ì¹´ë¡­ê²Œ ë§Œë“¤ì–´ ì¤„ ê±°ì˜ˆìš”.", "<strong>10ë¶„ ëª…ìƒìœ¼ë¡œ ë‡Œ ì¬ì¶©ì „:</strong> ì ì‹¬ ì‹ì‚¬ í›„ 10ë¶„ ì •ë„ì˜ ì§§ì€ ëª…ìƒì€ ë³µì¡í•œ ë¨¸ë¦¬ë¥¼ ì‹íˆê³  ì˜¤í›„ ì—…ë¬´ íš¨ìœ¨ì„ ë†’ì—¬ì¤˜ìš”." ], "recommendedTraining": "í˜„ì¬ì˜ ê· í˜•ê°ê°ì„ í•œ ë‹¨ê³„ ë°œì „ì‹œí‚¤ê¸° ìœ„í•´ 'ì „ëµì  ì‚¬ê³  ê²Œì„' ì„¸ì…˜ì„ ì¶”ì²œí•´ìš”. ì²´ìŠ¤ì²˜ëŸ¼ ì—¬ëŸ¬ ìˆ˜ë¥¼ ë‚´ë‹¤ë´ì•¼ í•˜ëŠ” ê²Œì„ì€ íŒë‹¨ë ¥ê³¼ ì§‘ì¤‘ë ¥ì„ ë™ì‹œì— ê°•í™”ì‹œì¼œ, 'ì„ íƒì˜ ì–´ë ¤ì›€'ì„ ê·¹ë³µí•˜ëŠ” ë° í° ë„ì›€ì´ ë  ê±°ì˜ˆìš”." },
      "roleModelName": "G-DRAGON", "roleModelDescription": "G-DRAGONì€ 'ê· í˜• ì¡íŒ ì—¬ìš°' íƒ€ì…ì´ í˜„ëŒ€ì˜ íŠ¸ë Œë“œë¥¼ ì–´ë–»ê²Œ ì°½ì¡°í•˜ê³  ì´ëŒì–´ê°€ëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ê°€ì¥ ìƒì§•ì ì¸ ì¸ë¬¼ì…ë‹ˆë‹¤. ê·¸ëŠ” ìŒì•… í”„ë¡œë“€ì‹±, ì‘ì‚¬, ì‘ê³¡ì€ ë¬¼ë¡  íŒ¨ì…˜ê³¼ ì‹œê° ì˜ˆìˆ ê¹Œì§€ ê²½ê³„ ì—†ì´ ë„˜ë‚˜ë“¤ë©° ë‹¤ì¬ë‹¤ëŠ¥í•¨ì˜ ì •ìˆ˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ëŠ” ì˜ˆì¸¡ë¶ˆí—ˆí•œ ëŒ€ì¤‘ì˜ ì·¨í–¥ì„ ì •í™•íˆ ê¿°ëš«ê³ , ëŠ˜ ìƒˆë¡œìš´ ê²°ê³¼ë¬¼ë¡œ ì„¼ì„¸ì´ì…˜ì„ ì¼ìœ¼í‚¤ëŠ” ì—¬ìš°ì˜ ê¸°ë¯¼í•¨ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤. ì¥ë¥´ë¥¼ íŒŒê´´í•˜ëŠ” ê·¸ì˜ ì‹¤í—˜ ì •ì‹ ê³¼ ìì‹ ë§Œì˜ ë¸Œëœë“œë¥¼ êµ¬ì¶•í•œ ê°ê°ì€ 'ê· í˜• ì¡íŒ ì—¬ìš°' íƒ€ì…ì´ ê°€ì§„ ì ì¬ë ¥ì˜ ë¬´í•œí•œ ê°€ëŠ¥ì„±ì„ ì¦ëª…í•©ë‹ˆë‹¤.", "roleModelAchievements": [ { "title": "ì†”ë¡œ ì•„í‹°ìŠ¤íŠ¸ ì„±ê³µ", "description": "'Heartbreaker', 'Coup d'Etat' ë“± ì•¨ë²” ì—°ì´ì–´ íˆíŠ¸" }, { "title": "ì „ë°©ìœ„ í”„ë¡œë“€ì„œ", "description": "BIGBANG ë° ë³¸ì¸ ì•¨ë²” ëŒ€ë¶€ë¶„ì˜ ê³¡ ì‘ì‚¬/ì‘ê³¡" }, { "title": "íŒ¨ì…˜ ë¸Œëœë“œ ë¡ ì¹­", "description": "'í”¼ìŠ¤ë§ˆì´ë„ˆìŠ¤ì›'ìœ¼ë¡œ ê¸€ë¡œë²Œ íŒ¨ì…˜ê³„ì— ì˜í–¥ë ¥ í–‰ì‚¬" }, { "title": "K-POP ì•„ì´ì½˜", "description": "ë…ë³´ì ì¸ ìŠ¤íƒ€ì¼ë¡œ ì „ ì„¸ê³„ ëŒ€ì¤‘ë¬¸í™” íŠ¸ë Œë“œ ì„ ë„" } ]
    };
    
    let brainTrendChartInstance, physicalTrendChartInstance;

    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
        renderReport(userData);
        setupSwipeable('#brain-analysis-container');
        setupSwipeable('#physical-analysis-container');
        setupSwipeable('#summary-container');
        setupSwipeable('#rolemodel-container');
        setupPremiumFeatures();
        
        const brainimalModal = document.getElementById('brainimalModal');
        const shareModal = document.getElementById('shareModal');
        setupModal(brainimalModal, 'openModalBtn', ['closeModalBtn']);
        setupModal(shareModal, 'shareBtn', ['closeShareModalBtn']);

        const saveButton = document.getElementById('saveBtn');
        const pdfLoader = document.getElementById('pdfLoader');
        saveButton.addEventListener('click', () => generatePdf(pdfLoader));
        
        window.onclick = (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.classList.add('hidden');
            }
        };

    });

    function calculateAge(birthDateString) {
        const birthDate = new Date(birthDateString);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) { age--; }
        return age;
    }
    
    function handleImageError(imgElement, fallbackText) {
        const container = imgElement.parentNode;
        const textElement = document.createElement('div');
        textElement.className = 'fallback-text-container';
        textElement.textContent = fallbackText;
        container.replaceChild(textElement, imgElement);
    }
    
    function handleProfileImageError(imgElement, userName, placeholderUrl) {
        const tryJpgUrl = `https://noilabofficial.github.io/noipod-report/${userName}_í”„ë¡œí•„.jpg`;
        if (imgElement.src !== tryJpgUrl) {
            imgElement.src = tryJpgUrl;
        } else {
            imgElement.src = placeholderUrl;
        }
    }

    function renderReport(data) {
        const actualAge = calculateAge(data.birth);
        document.getElementById('reportInfo').textContent = `ì œ ${data.reportCount}íšŒì°¨ ë‡Œì§€ì»¬ ë¦¬í¬íŠ¸ (${data.reportDate})`;
        document.getElementById('userName').textContent = data.userName;
        
        const profileImgElement = document.getElementById('profileImage');
        const profileImgBaseUrl = `https://noilabofficial.github.io/noipod-report/`;
        const profileImgPngUrl = `${profileImgBaseUrl}${data.userName}_í”„ë¡œí•„.png`;
        const placeholderUrl = `https://placehold.co/200x200/E2E8F0/475569?text=${data.userName.substring(0,1)}`;
        profileImgElement.src = profileImgPngUrl;
        profileImgElement.alt = `${data.userName}ë‹˜ì˜ í”„ë¡œí•„ ì‚¬ì§„`;
        profileImgElement.onerror = () => handleProfileImageError(profileImgElement, data.userName, placeholderUrl);

        document.getElementById('brainimalType').textContent = data.brainimalType;
        const brainAgeDiff = actualAge - data.brainAge;
        const physicalAgeDiff = actualAge - data.physicalAge;
        document.getElementById('ageInfoContainer').innerHTML = `<span>ë§Œ ${actualAge}ì„¸</span><span>ë‘ë‡Œ ë‚˜ì´: <span class="font-bold text-indigo-600">${data.brainAge}ì„¸</span> <span class="font-bold ${brainAgeDiff >= 0 ? 'text-green-600' : 'text-red-500'}">(${brainAgeDiff >= 0 ? `-${brainAgeDiff}` : `+${Math.abs(brainAgeDiff)}`})</span></span><span>ì‹ ì²´ ë‚˜ì´: <span class="font-bold text-sky-600">${data.physicalAge}ì„¸</span> <span class="font-bold ${physicalAgeDiff >= 0 ? 'text-green-600' : 'text-red-500'}">(${physicalAgeDiff >= 0 ? `-${physicalAgeDiff}` : `+${Math.abs(physicalAgeDiff)}`})</span></span>`;
        
        const brainMapContainer = document.getElementById('brain-map-container');
        let brainMapHTML = `<div class="grid grid-cols-3 gap-x-2 items-center text-center mb-2"><div></div><div class="font-bold text-slate-500 text-sm">ì•ˆì •ì‹œ</div><div class="font-bold text-slate-500 text-sm">ì§‘ì¤‘ì‹œ</div></div>`;
        const brainMapBaseUrl = `https://noilabofficial.github.io/noipod-report/`;
        const userName = data.userName;
        const latestReportNum = data.reportCount;
        for (let i = latestReportNum - 1; i <= latestReportNum; i++) {
            if (i <= 0) continue;
            const isLatest = (i === latestReportNum);
            const restingImgUrl = `${brainMapBaseUrl}${userName}${i}_R.png`;
            const concentratingImgUrl = `${brainMapBaseUrl}${userName}${i}_C.png`;
            brainMapHTML += `<div class="grid grid-cols-3 gap-x-2 items-center mb-2"><div class="font-bold text-slate-600 text-sm text-center">${i}íšŒì°¨</div><img src="${restingImgUrl}" class="rounded-lg w-4/5 aspect-square object-cover bg-black mx-auto ${isLatest ? 'border-2 border-indigo-500' : ''}" alt="ì•ˆì •ì‹œ ${i}íšŒì°¨" onerror="handleImageError(this, 'ì¶”ê°€ ê²€ì‚¬ í•„ìš”')"><img src="${concentratingImgUrl}" class="rounded-lg w-4/5 aspect-square object-cover bg-black mx-auto ${isLatest ? 'border-2 border-orange-500' : ''}" alt="ì§‘ì¤‘ì‹œ ${i}íšŒì°¨" onerror="handleImageError(this, 'ì¶”ê°€ ê²€ì‚¬ í•„ìš”')"></div>`;
        }
        brainMapContainer.innerHTML = brainMapHTML;
        createRadarChart('brainChart', Object.keys(data.brainScores), Object.values(data.brainScores));

        const physicalDetailsContainer = document.getElementById('physicalDetailsContainer');
        const physicalDetailsMap = {
            height: { label: "í‚¤", unit: "cm" },
            weight: { label: "ëª¸ë¬´ê²Œ", unit: "kg" },
            bmi: { label: "BMI", unit: "" },
            avgHeartRate: { label: "í‰ê·  ì‹¬ë°•ìˆ˜", unit: "bpm" },
            bmr: { label: "ê¸°ì´ˆ ëŒ€ì‚¬ëŸ‰", unit: "kcal" },
            bloodPressure: { label: "í˜ˆì••", unit: "" },
            oxygenSaturation: { label: "ì‚°ì†Œí¬í™”ë„", unit: "%" },
            stressLevel: { label: "ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜", unit: "" }
        };

        let detailsHTML = '';
        Object.keys(physicalDetailsMap).forEach(key => {
            const value = data.physicalDetails ? data.physicalDetails[key] : null;
            if (value !== null && value !== undefined) {
                detailsHTML += `<div class="bg-slate-50 p-2 rounded-lg flex flex-col justify-center h-full"><p class="text-xs text-slate-500">${physicalDetailsMap[key].label}</p><p class="text-lg font-bold text-slate-800 mt-1">${value}<span class="text-sm font-normal">${physicalDetailsMap[key].unit}</span></p></div>`;
            } else {
                detailsHTML += `<div class="bg-slate-50 p-2 rounded-lg flex flex-col justify-center h-full"><p class="text-xs text-slate-500">${physicalDetailsMap[key].label}</p><div class="fallback-text-container my-auto">ì¶”ê°€ ê²€ì‚¬ í•„ìš”</div></div>`;
            }
        });
        physicalDetailsContainer.innerHTML = detailsHTML;
        
        createRadarChart('physicalChart', Object.keys(data.physicalScores), Object.values(data.physicalScores));

        document.getElementById('brainimalSummary').innerHTML = data.brainimalSummary.replace('{userName}', data.userName).replace('{brainimalType}', data.brainimalType).replace('{brainAgeDiff}', brainAgeDiff).replace('{physicalAgeDiff}', physicalAgeDiff);
        document.getElementById('brainimalDescription').textContent = data.brainimalDescription;
        document.getElementById('advantagesList').innerHTML = data.advantages.map(item => `<li>${item}</li>`).join('');
        document.getElementById('disadvantagesList').innerHTML = data.disadvantages.map(item => `<li>${item}</li>`).join('');
        document.getElementById('feedbackIntro').textContent = data.feedbackIntro.replace('ê¹€ì§€ìˆ˜', data.userName);
        if (data.feedbackContent) { document.getElementById('feedbackContent').innerHTML = `<div><h5 class="font-bold text-slate-800 mb-3">ğŸƒâ€â™€ï¸ ìƒí™œ ì† ë…¸ë ¥</h5><ul class="space-y-3 text-slate-700">${data.feedbackContent.dailyEfforts.map(item => `<li class="flex items-start"><span class="mr-3 text-lg">âœ…</span><span>${item}</span></li>`).join('')}</ul></div><div><h5 class="font-bold text-slate-800 mb-3">ğŸ§  ì¶”ì²œ íŠ¸ë ˆì´ë‹</h5><p class="text-slate-700">${data.feedbackContent.recommendedTraining}</p></div>`; }
        document.getElementById('roleModelName').textContent = `ê· í˜• ì¡íŒ ì—¬ìš°ì˜ ëíŒì™•: ${data.roleModelName}`;
        document.getElementById('roleModelDescription').textContent = data.roleModelDescription;
        document.getElementById('roleModelAchievements').innerHTML = data.roleModelAchievements.map(item => `<li class="flex items-start"><span class="mr-3 text-indigo-500 mt-1"><i data-lucide="check-square" class="w-5 h-5"></i></span><div><p class="font-bold text-slate-800">${item.title}</p><p class="text-sm text-slate-500">${item.description}</p></div></li>`).join('');
        lucide.createIcons();
    }

    function createRadarChart(elementId, labels, myData) {
        const ctx = document.getElementById(elementId).getContext('2d');
        const avgData = new Array(myData.length).fill(70);
        
        const allScores = Object.values(myData);
        let minScore = Math.min(...allScores);
        let suggestedMin = 40;
        if (minScore < 40) {
            suggestedMin = Math.floor(minScore / 20) * 20;
        }

        const colors = (elementId === 'brainChart') ? { my: { bg: 'rgba(79, 70, 229, 0.2)', border: 'rgba(79, 70, 229, 1)' }, avg: { bg: 'rgba(148, 163, 184, 0.2)', border: 'rgba(100, 116, 139, 1)' } } : { my: { bg: 'rgba(14, 165, 233, 0.2)', border: 'rgba(14, 165, 233, 1)' }, avg: { bg: 'rgba(148, 163, 184, 0.2)', border: 'rgba(100, 116, 139, 1)' } };
        new Chart(ctx, { type: 'radar', data: { labels: labels, datasets: [{ label: 'ë‚´ ì ìˆ˜', data: myData, backgroundColor: colors.my.bg, borderColor: colors.my.border, borderWidth: 3 }, { label: 'ë™ë‚˜ì´ëŒ€ í‰ê· ', data: avgData, backgroundColor: colors.avg.bg, borderColor: colors.avg.border, borderWidth: 2, borderDash: [3, 3] }] }, 
            options: { 
                maintainAspectRatio: false,
                scales: { 
                    r: { 
                        suggestedMin: suggestedMin, 
                        suggestedMax: 100, 
                        pointLabels: { font: { size: 14, weight: 'bold' } }, 
                        ticks: { backdropColor: 'rgba(255, 255, 255, 0.75)', stepSize: 20 } 
                    } 
                }, 
                plugins: { legend: { position: 'bottom' } } 
            } 
        });
    }
    
    function setupPremiumFeatures() {
        const premiumModal = document.getElementById('premiumModal');
        setupModal(premiumModal, null, ['closePremiumModalBtn']);

        const premiumLocks = document.querySelectorAll('.premium-lock');
        const premiumButtons = document.querySelectorAll('.trend-btn.premium-feature');

        if (!userData.isPremium) {
            premiumLocks.forEach(lock => {
                const overlay = lock.querySelector('.premium-overlay');
                if (overlay) {
                    overlay.classList.add('active');
                    overlay.addEventListener('click', () => premiumModal.classList.remove('hidden'));
                }
            });
            premiumButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    premiumModal.classList.remove('hidden');
                });
            });
        } else {
             document.getElementById('toggleBrainTrendBtn').addEventListener('click', () => toggleTrendChart('brain'));
             document.getElementById('togglePhysicalTrendBtn').addEventListener('click', () => toggleTrendChart('physical'));
        }
    }

    function toggleTrendChart(type) {
        const container = document.getElementById(`${type}TrendContainer`);
        const chartInstance = (type === 'brain') ? brainTrendChartInstance : physicalTrendChartInstance;
        const isVisible = container.style.display === 'block';

        if (isVisible) {
            container.style.display = 'none';
        } else {
            container.style.display = 'block';
            if (chartInstance) {
                const toggles = container.querySelectorAll('.metric-toggle');
                chartInstance.data.datasets.forEach((dataset, index) => {
                    chartInstance.setDatasetVisibility(index, true);
                    toggles[index].classList.remove('inactive');
                    toggles[index].style.backgroundColor = dataset.borderColor;
                    toggles[index].style.color = 'white';
                });
                chartInstance.update();
            } else {
                if (type === 'brain') {
                    brainTrendChartInstance = createLineChart('brain', userData.brainScoreHistory, userData.brainScoreTarget);
                } else {
                    physicalTrendChartInstance = createLineChart('physical', userData.physicalScoreHistory, userData.physicalScoreTarget);
                }
            }
        }
    }

    function createLineChart(type, historyData, targetData) {
        const containerId = `${type}TrendContainer`;
        const chartId = `${type}TrendChart`;
        const togglesId = `${type}TrendToggles`;
        const togglesContainer = document.getElementById(togglesId);
        
        const labels = historyData.map((_, index) => `${userData.reportCount - historyData.length + index + 1}íšŒì°¨`).concat('ëª©í‘œ');
        const metricKeys = Object.keys(historyData[0]);
        const colors = (type === 'brain') 
            ? ['#4f46e5', '#3b82f6', '#14b8a6', '#8b5cf6'] 
            : ['#0ea5e9', '#059669', '#f59e0b', '#ef4444'];

        const datasets = metricKeys.map((key, index) => {
            const history = historyData.map(d => d[key]);
            const target = targetData[key];
            const dataWithTarget = history.concat(target);
            return {
                label: key,
                data: dataWithTarget,
                borderColor: colors[index % colors.length],
                backgroundColor: colors[index % colors.length] + '33',
                tension: 0.3,
                borderWidth: 3,
                pointRadius: 4,
                pointBackgroundColor: colors[index % colors.length],
                hidden: false,
                segment: {
                    borderDash: (ctx) => (ctx.p1DataIndex === history.length ? [6, 6] : undefined),
                    borderColor: (ctx) => {
                        if (ctx.p1DataIndex === history.length && ctx.p0 && ctx.p1) {
                            const gradient = ctx.chart.ctx.createLinearGradient(ctx.p0.x, 0, ctx.p1.x, 0);
                            gradient.addColorStop(0, colors[index % colors.length]);
                            gradient.addColorStop(1, 'rgba(156, 163, 175, 0.7)');
                            return gradient;
                        }
                        return undefined;
                    }
                },
                pointBackgroundColor: (ctx) => (ctx.dataIndex === history.length ? '#ffffff' : colors[index % colors.length]),
                pointBorderColor: (ctx) => (ctx.dataIndex === history.length ? 'rgba(156, 163, 175, 0.7)' : colors[index % colors.length]),
                pointBorderWidth: (ctx) => (ctx.dataIndex === history.length ? 3 : 0),
                pointRadius: (ctx) => (ctx.dataIndex === history.length ? 6 : 4)
            };
        });
        
        const allScores = historyData.flatMap(d => Object.values(d));
        let minScore = Math.min(...allScores);
        let suggestedMin = 40;
        if (minScore < 40) {
            suggestedMin = Math.floor(minScore / 10) * 10;
        }

        const ctx = document.getElementById(chartId).getContext('2d');
        const chart = new Chart(ctx, { 
            type: 'line', 
            data: { labels, datasets }, 
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                scales: { y: { min: suggestedMin, max: 100, ticks: { stepSize: 10 } } }, 
                plugins: { legend: { display: false } } 
            }
        });

        togglesContainer.innerHTML = '';
        metricKeys.forEach((key, index) => {
            const button = document.createElement('button');
            const lastScore = historyData[historyData.length-1][key];
            const targetScore = targetData[key];
            let emoji = '';
            if(lastScore >= targetScore) {
                emoji = 'âœ…';
            } else if (lastScore >= targetScore * 0.9) {
                emoji = 'âš ï¸';
            } else {
                emoji = 'ğŸ“‰';
            }
            button.innerHTML = `<span>${key}</span><span>${emoji}</span>`;
            
            button.className = 'metric-toggle';
            button.style.backgroundColor = colors[index % colors.length];
            button.style.color = 'white';
            button.style.borderColor = colors[index % colors.length];

            button.addEventListener('click', () => {
                const meta = chart.getDatasetMeta(index);
                meta.hidden = !meta.hidden;
                
                if (meta.hidden) {
                    button.classList.add('inactive');
                    button.style.backgroundColor = '';
                    button.style.color = '';
                } else {
                    button.classList.remove('inactive');
                    button.style.backgroundColor = colors[index % colors.length];
                    button.style.color = 'white';
                }
                chart.update();

                const allHidden = chart.data.datasets.every((ds, i) => chart.getDatasetMeta(i).hidden);
                if (allHidden) {
                    document.getElementById(containerId).style.display = 'none';
                }
            });
            togglesContainer.appendChild(button);
        });

        return chart;
    }

    function setupModal(modal, openBtnId, closeBtnIds) {
        if (!modal) return;
        const openBtn = document.getElementById(openBtnId);
        if (openBtn) { openBtn.onclick = () => modal.classList.remove('hidden'); }
        closeBtnIds.forEach(id => {
            const closeBtn = document.getElementById(id);
            if (closeBtn) { closeBtn.onclick = () => modal.classList.add('hidden'); }
        });
    }

    function setupSwipeable(containerSelector) {
        const container = document.querySelector(containerSelector);
        if (!container) return;
        const track = container.querySelector('.swipe-track');
        const dotsContainer = container.querySelector('.swipe-dots');
        if (!track || !dotsContainer) return;
        const slides = Array.from(track.children);
        if (slides.length <= 1) { dotsContainer.style.display = 'none'; return; }

        let currentIndex = 0, isDragging = false, startPos = 0, currentTranslate = 0, prevTranslate = 0, animationID;
        slides.forEach((_, i) => { const dot = document.createElement('button'); dot.classList.add('swipe-dot'); if (i === 0) dot.classList.add('active'); dot.addEventListener('click', () => { currentIndex = i; setPositionByIndex(); }); dotsContainer.appendChild(dot); });
        const dots = Array.from(dotsContainer.children);
        function updateDots() { dots.forEach(dot => dot.classList.remove('active')); dots[currentIndex].classList.add('active'); }
        function setPositionByIndex() { currentTranslate = currentIndex * -slides[0].offsetWidth; prevTranslate = currentTranslate; setSliderPosition(); updateDots(); }
        function setSliderPosition() { track.style.transform = `translateX(${currentTranslate}px)`; }
        function touchStart(index) { return function(event) { if (window.innerWidth >= 1024) return; currentIndex = index; startPos = getPositionX(event); isDragging = true; animationID = requestAnimationFrame(animation); track.style.transition = 'none'; } }
        function touchMove(event) { if (isDragging && window.innerWidth < 1024) { const currentPosition = getPositionX(event); currentTranslate = prevTranslate + currentPosition - startPos; } }
        function touchEnd() { if (!isDragging || window.innerWidth >= 1024) return; isDragging = false; cancelAnimationFrame(animationID); const movedBy = currentTranslate - prevTranslate; if (movedBy < -100 && currentIndex < slides.length - 1) currentIndex += 1; if (movedBy > 100 && currentIndex > 0) currentIndex -= 1; setPositionByIndex(); track.style.transition = 'transform 0.3s ease-out'; }
        function getPositionX(event) { return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX; }
        function animation() { setSliderPosition(); if (isDragging) requestAnimationFrame(animation); }
        slides.forEach((slide, index) => { slide.addEventListener('dragstart', (e) => e.preventDefault()); slide.addEventListener('touchstart', touchStart(index), {passive: true}); slide.addEventListener('touchend', touchEnd); slide.addEventListener('touchmove', touchMove, {passive: true}); });
        window.addEventListener('resize', () => { if (window.innerWidth >= 1024) { track.style.transform = ''; } else { setPositionByIndex(); } });
    }

    function generatePdf(loaderElement) {
        const element = document.getElementById('reportContent');
        const pageBreak = element.querySelector('.page-break-pdf');
        const actionButtons = document.getElementById('actionButtons');
        const previouslyActiveTrends = [];

        const toggleButtonSelectors = [
            { buttonId: 'toggleBrainTrendBtn', containerId: 'brainTrendContainer', chartKey: 'brain' },
            { buttonId: 'togglePhysicalTrendBtn', containerId: 'physicalTrendContainer', chartKey: 'physical' }
        ];

        toggleButtonSelectors.forEach(({ buttonId, containerId, chartKey }) => {
            const toggleBtn = document.getElementById(buttonId);
            const container = document.getElementById(containerId);
            if (container && container.style.display === 'block') {
                previouslyActiveTrends.push(chartKey);
            } else if (toggleBtn && container && userData.isPremium) {
                toggleBtn.click();
            }
        });

        const opt = {
            margin:       [8, 10, 10, 10],
            filename:     `NoiPod_Report_${userData.userName}_${userData.reportDate}.pdf`,
            image:        { type: 'jpeg', quality: 0.95 },
            html2canvas:  { 
                scale: 2,
                useCORS: true,
                allowTaint: true,
                windowWidth: element.scrollWidth
            },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
            pagebreak:    { mode: ['css', 'legacy'] }
        };

        if (loaderElement) loaderElement.style.display = 'flex';
        document.body.classList.add('pdf-mode');
        const previousScroll = window.pageYOffset;
        window.scrollTo({ top: 0, behavior: 'auto' });
        if (pageBreak) pageBreak.style.display = 'block';
        if (actionButtons) actionButtons.style.display = 'none';

        const chartInstances = Chart.instances instanceof Map
            ? Array.from(Chart.instances.values())
            : Object.values(Chart.instances || {});
        chartInstances.forEach(instance => {
            if (instance && typeof instance.resize === 'function') {
                instance.resize();
            }
        });

        html2pdf().from(element).set(opt).save().then(() => {
            cleanupPdfState();
        }).catch(error => {
            console.error('Error generating PDF:', error);
            cleanupPdfState();
        });

        function cleanupPdfState() {
            if (loaderElement) loaderElement.style.display = 'none';
            document.body.classList.remove('pdf-mode');
            if (pageBreak) pageBreak.style.display = 'none';
            if (actionButtons) actionButtons.style.display = '';
            window.scrollTo({ top: previousScroll, behavior: 'auto' });
            toggleButtonSelectors.forEach(({ buttonId, containerId, chartKey }) => {
                const container = document.getElementById(containerId);
                if (!previouslyActiveTrends.includes(chartKey) && container && container.style.display === 'block') {
                    document.getElementById(buttonId)?.click();
                }
            });
        }
    }
    </script>
</body>
</html>
